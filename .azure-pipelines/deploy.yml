trigger: none

pool: 'Dedicated'

stages: 
- stage: Build
  jobs:
  - template: templates/build-web-app.yml
    parameters: 
      jobName: 'BuildPublicWebApp'
      projectName: 'public-webapp'
      publishArtifact: true

  - template: templates/build-web-app.yml
    parameters: 
      jobName: 'BuildLookupWebApi'
      projectName: 'lookup-webapi'
      publishArtifact: true

- stage: DeployPrdPlatform
  jobs:
  - job: DeployAADResources
    steps:
      - task: AzureCLI@2
        displayName: CreateAppRegistrations
        inputs:
          azureSubscription: 'sub-fm-geolocation-prd'
          scriptType: 'pscore'
          scriptLocation: 'scriptPath'
          arguments: 'prd'
          scriptPath: '$(Build.sourcesDirectory)/.azure-pipelines/scripts/CreateAppRegistrations.ps1'